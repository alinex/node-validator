<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for src/type/percent.coffee</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../prettify.css" />
    <link rel="stylesheet" href="../../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../../index.html">all files</a> / <a href="index.html">src/type/</a> percent.coffee
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>0/79</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/24</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>0/7</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>0/56</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js"># Percent check
# =================================================
&nbsp;
# Sanitize options allowed:
#
# - `unit` - (string) type of unit to convert if not integer given
# - `round` - (bool) rounding can be set to true for arithmetic rounding
#   or use `floor` or `ceil` for the corresponding methods
# - `decimals` - (int) number of decimal digits to round to (defaults to 2)
#
# Check options:
#
# - `min` - (integer) the smalles allowed number
# - `max` - (integer) the biggest allowed number
&nbsp;
# Node modules
# -------------------------------------------------
<span class="cstat-no" title="statement not covered" >debug = require('debug')('validator:percent')</span>
<span class="cstat-no" title="statement not covered" >chalk = require 'chalk'</span>
<span class="cstat-no" title="statement not covered" >numeral = null</span> # load on demand
# alinex modules
<span class="cstat-no" title="statement not covered" >util = require 'alinex-util'</span>
# include classes and helper
<span class="cstat-no" title="statement not covered" >check = require '../check'</span>
&nbsp;
# Optimize options setting
# -------------------------------------------------
<span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >optimize = (schema) -&gt;</span></span>
<span class="cstat-no" title="statement not covered" >  if schema.decimals? and not schema.round</span>
<span class="cstat-no" title="statement not covered" >    schema.round = true</span>
<span class="cstat-no" title="statement not covered" >  if schema.round and not schema.decimals?</span>
<span class="cstat-no" title="statement not covered" >    schema.decimals = 2</span>
<span class="cstat-no" title="statement not covered" >  schema</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >subcheck =</span>
  type: 'or'
  or: [
    type: 'float'
  ,
    type: 'string'
    match: ///
      ^\s*      # start with possible spaces
      [+-]?     # sign possible
      \s*\d+(\.\d*)? # float number
      \s*%?     # percent sign with spaces
      \s*$      # end of text with spaces
      ///
  ]
&nbsp;
# Type implementation
# -------------------------------------------------
<span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >exports.describe = (work, cb) -&gt;</span></span>
<span class="cstat-no" title="statement not covered" >  work.pos = optimize work.pos</span>
  # combine into message
<span class="cstat-no" title="statement not covered" >  text = 'A percentage value as decimal like 0.3 but it may be given</span>
  as percent value text like 30%, too. '
<span class="cstat-no" title="statement not covered" >  text += check.optional.describe work</span>
<span class="cstat-no" title="statement not covered" >  text = text.replace /\. It's/, ' which is'</span>
  # subcheck
<span class="cstat-no" title="statement not covered" >  name = work.spec.name ? 'value'</span>
<span class="cstat-no" title="statement not covered" >  if work.path.length</span>
<span class="cstat-no" title="statement not covered" >    name += <span class="cstat-no" title="statement not covered" >"/#{<span class="cstat-no" title="statement not covered" >work.path.join '/'</span>}</span>"</span>
<span class="cstat-no" title="statement not covered" >  check.describe</span>
    name: name
    schema:
      type: 'float'
      round: work.pos.round
      decimals: work.pos.decimals
      min: work.pos.min
      max: work.pos.max
  , <span class="fstat-no" title="function not covered" >(err, subtext) -&gt;</span>
<span class="cstat-no" title="statement not covered" >    if work.pos.format</span>
<span class="cstat-no" title="statement not covered" >      text += <span class="cstat-no" title="statement not covered" >"The number will be formatted like #{<span class="cstat-no" title="statement not covered" >work</span>.pos.format}. "</span></span>
    # the float check will never throw an error, so go on
<span class="cstat-no" title="statement not covered" >    cb null, text + subtext</span>
&nbsp;
<span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >exports.run = (work, cb) -&gt;</span></span>
<span class="cstat-no" title="statement not covered" >  work.pos = optimize work.pos</span>
<span class="cstat-no" title="statement not covered" >  debug "#<span class="cstat-no" title="statement not covered" >{<span class="cstat-no" title="statement not covered" >work</span>.debug} with #{<span class="cstat-no" title="statement not covered" >util.inspect work.value</span>} as #{<span class="cstat-no" title="statement not covered" >work</span>.pos.type}</span>"</span>
<span class="cstat-no" title="statement not covered" >  debug "#<span class="cstat-no" title="statement not covered" >{<span class="cstat-no" title="statement not covered" >work</span>.debug} #{<span class="cstat-no" title="statement not covered" >chalk.grey util.inspect work.pos</span>}</span>"</span>
  # base checks
<span class="cstat-no" title="statement not covered" >  try</span>
<span class="cstat-no" title="statement not covered" >    if check.optional.run work</span>
<span class="cstat-no" title="statement not covered" >      debug "#<span class="cstat-no" title="statement not covered" >{<span class="cstat-no" title="statement not covered" >work</span>.debug} result #{<span class="cstat-no" title="statement not covered" >util.inspect work.value ? null</span>}</span>"</span>
<span class="cstat-no" title="statement not covered" >      return cb()</span>
  catch error
<span class="cstat-no" title="statement not covered" >    return work.report error, cb</span>
  # first check input type
<span class="cstat-no" title="statement not covered" >  name = work.spec.name ? 'value'</span>
<span class="cstat-no" title="statement not covered" >  if work.path.length</span>
<span class="cstat-no" title="statement not covered" >    name += <span class="cstat-no" title="statement not covered" >"/#{<span class="cstat-no" title="statement not covered" >work.path.join '/'</span>}</span>"</span>
<span class="cstat-no" title="statement not covered" >  check.run</span>
    name: name
    value: work.value
    schema: subcheck
  , <span class="fstat-no" title="function not covered" >(err, value) -&gt;</span>
<span class="cstat-no" title="statement not covered" ><span class="cstat-no" title="statement not covered" >    return cb err</span> if err</span>
    # get float from string
<span class="cstat-no" title="statement not covered" >    if typeof value is 'string' and value.trim().slice(-1) is '%'</span>
<span class="cstat-no" title="statement not covered" >      value = value[0..-2] / 100</span>
    else
<span class="cstat-no" title="statement not covered" >      value = parseFloat value</span>
    # validate number
<span class="cstat-no" title="statement not covered" >    check.run</span>
      name: name
      value: value
      schema:
        type: 'float'
        round: work.pos.round
        decimals: work.pos.decimals
        min: work.pos.min
        max: work.pos.max
    , <span class="fstat-no" title="function not covered" >(err, value) -&gt;</span>
<span class="cstat-no" title="statement not covered" ><span class="cstat-no" title="statement not covered" >      return cb err</span> if err</span>
<span class="cstat-no" title="statement not covered" >      if work.pos.format</span>
<span class="cstat-no" title="statement not covered" >        numeral ?= require 'numeral'</span>
<span class="cstat-no" title="statement not covered" >        if work.pos.locale</span>
<span class="cstat-no" title="statement not covered" >          try</span>
<span class="cstat-no" title="statement not covered" >            numeral.language work.pos.locale, require <span class="cstat-no" title="statement not covered" >"numeral/languages/#{<span class="cstat-no" title="statement not covered" >work</span>.pos.locale}</span>"</span>
<span class="cstat-no" title="statement not covered" >            numeral.language work.pos.locale</span>
<span class="cstat-no" title="statement not covered" >        value = numeral(value).format work.pos.format</span>
<span class="cstat-no" title="statement not covered" >        if work.pos.locale</span>
<span class="cstat-no" title="statement not covered" >          numeral.language 'en'</span>
      # done return resulting value
<span class="cstat-no" title="statement not covered" >      debug "#<span class="cstat-no" title="statement not covered" >{<span class="cstat-no" title="statement not covered" >work</span>.debug} result #{<span class="cstat-no" title="statement not covered" >util.inspect value ? null</span>}</span>"</span>
<span class="cstat-no" title="statement not covered" >      cb null, value</span>
&nbsp;
<span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >exports.selfcheck = (schema, cb) -&gt;</span></span>
<span class="cstat-no" title="statement not covered" >  check.run</span>
    schema:
      type: 'object'
      allowedKeys: true
      keys: util.extend util.clone(check.base),
        default:
          type: 'float'
          optional: true
        round:
          type: 'or'
          optional: true
          or: [
            type: 'boolean'
          ,
            type: 'string'
            values: ['floor', 'ceil']
          ]
        decimals:
          type: 'integer'
          optional: true
          min: 0
        min:
          type: 'float'
          optional: true
        max:
          type: 'float'
          optional: true
          min: '&lt;&lt;&lt;min&gt;&gt;&gt;'
        format:
          type: 'string'
          optional: true
        locale:
          type: 'string'
          match: /^[a-z]{2}(-[A-Z]{2})?$/
          optional: true
    value: schema
  , cb
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Wed Apr 20 2016 22:00:03 GMT+0200 (CEST)
</div>
</div>
<script src="../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../sorter.js"></script>
</body>
</html>
