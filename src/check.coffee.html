<!DOCTYPE html>
<html>
<head>
  <title>check.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../doc-style.css" />
  <script src="../doc-filelist.js"></script>
  <script>
    var relativeDir = "../";
    var thisFile = "src/check.coffee";
    var defaultSidebar = true;
  </script>
  <script src="../doc-script.js"></script>

<meta name="viewport" content="width=device-width, initial-scale=1.0" /></head>
<body>
  <nav>
<div class="logo"><a href="http://alinex.github.io"
  onmouseover="logo.src='https://alinex.github.io/images/Alinex-200.png'"
  onmouseout="logo.src='https://alinex.github.io/images/Alinex-black-200.png'">
  <img name="logo" src="https://alinex.github.io/images/Alinex-black-200.png"
    width="150" title="Alinex Universe Homepage" />
  </a>
  <img src="http://alinex.github.io/images/Alinex-200.png"
    style="display:none" alt="preloading" />
</div>
<div class="links">
  <a href="http://alinex.github.io/blog"
    class="btn btn-primary"><span class="glyphicon-pencil"></span> Blog</a>
  <a href="http://alinex.github.io/develop"
    class="btn btn-primary"><span class="glyphicon-book"></span> Develop</a>
  <a href="http://alinex.github.io/code.html"
    class="btn btn-warning"><span class="glyphicon-cog"></span> Code</a>
</div>
</nav><div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h1">
        <a href="#check-class">Check class</a>
      </div>

      <div class="heading h2">
        <a href="#node-modules">Node modules</a>
      </div>

      <div class="heading h2">
        <a href="#work-management">Work management</a>
      </div>

      <div class="heading h3">
        <a href="#create-a-new-work-instance">Create a new work instance</a>
      </div>

      <div class="heading h3">
        <a href="#report-an-error">Report an error</a>
      </div>

      <div class="heading h3">
        <a href="#go-into">Go into</a>
      </div>

      <div class="heading h2">
        <a href="#helper-methods">Helper methods</a>
      </div>

      <div class="heading h3">
        <a href="#get-type-library">Get type library</a>
      </div>

      <div class="heading h3">
        <a href="#is-value-empty">Is value empty?</a>
      </div>

      <div class="heading h2">
        <a href="#main-routines">Main routines</a>
      </div>

      <div class="heading h3">
        <a href="#get-description-of-schema">Get description of schema</a>
      </div>

      <div class="heading h3">
        <a href="#run-check">Run check</a>
      </div>

      <div class="heading h3">
        <a href="#selfcheck-of-schema">Selfcheck of schema</a>
      </div>

      <div class="heading h2">
        <a href="#general-checks">General checks</a>
      </div>

      <div class="heading h3">
        <a href="#optional-and-default-checks">Optional and default checks</a>
      </div>

      <div class="heading h3">
        <a href="#selfcheck-schema-for-base-options">selfcheck schema for base options</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container" tabindex="0"><a id="fork" href="https://github.com/alinex/node-validator" title="Fork me on GitHub"></a>
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="check-class">
  <h1>
    <a href="#check-class" name="check-class" class="pilcrow"></a>
Check class
  </h1>
</div>

        </td>
        <td class="code highlight">
          
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="node-modules">
  <h2>
    <a href="#node-modules" name="node-modules" class="pilcrow"></a>
Node modules
  </h2>
</div>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">debug = <span class="hljs-built_in">require</span>(<span class="hljs-string">'debug'</span>)(<span class="hljs-string">'validator:check'</span>)
chalk = <span class="hljs-built_in">require</span> <span class="hljs-string">'chalk'</span>
async = <span class="hljs-built_in">require</span> <span class="hljs-string">'async'</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>alinex packages</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">util = <span class="hljs-built_in">require</span> <span class="hljs-string">'alinex-util'</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>internal classes and helper</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">reference = <span class="hljs-built_in">require</span> <span class="hljs-string">'./reference'</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="work-management">
  <h2>
    <a href="#work-management" name="work-management" class="pilcrow"></a>
Work management
  </h2>
</div>
<p>The work class contains all relevant informations for an work step within the
complete check run.</p>
<p>The following properties are used:</p>
<ul>
<li>spec - reference to the original validation call
<ul>
<li>name - (string) descriptive name of the data</li>
<li>schema - (object) structure to check</li>
<li>context - (object) additional data structure</li>
<li>dir - set to base directory for file relative file paths</li>
<li>value - original value (not changed)</li>
<li>failed - internally used to check for references to unchecked parts</li>
<li>done - internally used as list of checked paths</li>
</ul>
</li>
<li>path - array containing the current path</li>
<li>pos - reference to schema position at this path</li>
<li>debug - output of current path for debugging</li>
<li>value - value at this path</li>
<li>vpath - path of value</li>
<li>retry counter for retry to get references checked</li>
</ul>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Work</span></span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="create-a-new-work-instance">
  <h3>
    <a href="#create-a-new-work-instance" name="create-a-new-work-instance" class="pilcrow"></a>
Create a new work instance
  </h3>
</div>
<p>Initialize the work structure and set some defaults.</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  constructor: <span class="hljs-function"><span class="hljs-params">(@spec)</span> -&gt;</span>
    @spec.done ?= []      <span class="hljs-comment"># list of checked paths</span>
    @path ?= []           <span class="hljs-comment"># current path in schema structure</span>
    @pos ?= @spec.schema  <span class="hljs-comment"># reference to schema at path (root)</span>
    @vpath ?= []          <span class="hljs-comment"># current path in value structure</span>
    @value = @spec.value  <span class="hljs-comment"># reference to value at path (root)</span>
    @debug = chalk.grey <span class="hljs-string">"<span class="hljs-subst">#{@spec.name ? <span class="hljs-string">'value'</span>}</span>/<span class="hljs-subst">#{@path.join <span class="hljs-string">'/'</span>}</span>"</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="report-an-error">
  <h3>
    <a href="#report-an-error" name="report-an-error" class="pilcrow"></a>
Report an error
  </h3>
</div>
<p>This method will use the given Error and make it more readable by adding
context information. And adding an additional <code>description</code> property
containing a detailed description of what is allowed at the current
position.</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  report: <span class="hljs-function"><span class="hljs-params">(err, cb)</span> -&gt;</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>create title with context info</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">    message = <span class="hljs-string">"<span class="hljs-subst">#{err.message}</span> in <span class="hljs-subst">#{@spec.name ? <span class="hljs-string">'value'</span>}</span>:/<span class="hljs-subst">#{@vpath.join <span class="hljs-string">'/'</span>}</span>"</span>
    message += <span class="hljs-string">" '<span class="hljs-subst">#{@pos.title}</span>'"</span> <span class="hljs-keyword">if</span> @pos.title?
    message += <span class="hljs-string">" (described in schema:/<span class="hljs-subst">#{@path.join <span class="hljs-string">'/'</span>}</span>). "</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>create description</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">    detail = <span class="hljs-string">''</span>
    <span class="hljs-keyword">if</span> @pos.description?
      desc = @pos.description[<span class="hljs-number">0</span>].toLowerCase() + @pos.description[<span class="hljs-number">1.</span>.]
      desc = desc.replace <span class="hljs-regexp">/\.\s*$/</span>, <span class="hljs-string">''</span>
      detail = <span class="hljs-string">"It should contain <span class="hljs-subst">#{desc}</span>. \n"</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>add type specific information</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">    exports.describe <span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-params">(err, text)</span> =&gt;</span>
      detail += text
      debug @debug + chalk.magenta <span class="hljs-string">" Error: <span class="hljs-subst">#{message}</span>"</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>create new Error object</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">      err = <span class="hljs-keyword">new</span> Error message
      err.description = detail <span class="hljs-keyword">if</span> detail
      err.path = @vpath.join <span class="hljs-string">'/'</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>send error through callback</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">      cb err</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="go-into">
  <h3>
    <a href="#go-into" name="go-into" class="pilcrow"></a>
Go into
  </h3>
</div>
<p>Get a new work object representing the inner position of the current work
object. The position may change in the schema and/or value position.
This makes the new object containing the information at the old path
concatenated with the given paths.</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  goInto: <span class="hljs-function"><span class="hljs-params">(schema = [], value = [])</span> -&gt;</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<p>create new instance</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">    sub = <span class="hljs-keyword">new</span> Work @spec
    <span class="hljs-keyword">if</span> schema.length</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<p>go one step into schema structure</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">      name = schema.shift()
      sub.path = @path.concat name
      sub.pos = <span class="hljs-keyword">if</span> @pos[name]? <span class="hljs-keyword">then</span>  @pos[name] <span class="hljs-keyword">else</span> @pos
      sub.debug = chalk.grey <span class="hljs-string">"<span class="hljs-subst">#{sub.spec.name ? <span class="hljs-string">'value'</span>}</span>/<span class="hljs-subst">#{sub.path.join <span class="hljs-string">'/'</span>}</span>"</span>
    <span class="hljs-keyword">else</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<p>keep schema position but clone path</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">      sub.path = @path[<span class="hljs-number">0.</span>.]
      sub.pos = @pos
      sub.debug = @debug
    <span class="hljs-keyword">if</span> value.length</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<p>go one step into value structure</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">      v = value.shift()
      sub.vpath = @vpath.concat v
      sub.value = <span class="hljs-keyword">if</span> @value[v]? <span class="hljs-keyword">then</span>  @value[v] <span class="hljs-keyword">else</span> <span class="hljs-literal">undefined</span>
    <span class="hljs-keyword">else</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<p>keep value position but clone path</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">      sub.vpath = @vpath[<span class="hljs-number">0.</span>.]
      sub.value = util.clone @value</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19"></a>
</div>
<p>end call if no more steps to go into</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">    <span class="hljs-keyword">return</span> sub <span class="hljs-keyword">unless</span> schema.length <span class="hljs-keyword">or</span> value.length</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20"></a>
</div>
<p>recursively go one step further</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">    sub.goInto schema, value</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="helper-methods">
  <h2>
    <a href="#helper-methods" name="helper-methods" class="pilcrow"></a>
Helper methods
  </h2>
</div>

        </td>
        <td class="code highlight">
          
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="get-type-library">
  <h3>
    <a href="#get-type-library" name="get-type-library" class="pilcrow"></a>
Get type library
  </h3>
</div>
<p>Dynamically loading of type check.</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript"><span class="hljs-function"><span class="hljs-title">getTypeLib</span> = <span class="hljs-params">(type)</span> -&gt;</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23"></a>
</div>
<p>check type</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  <span class="hljs-keyword">unless</span> <span class="hljs-keyword">typeof</span> type?.type  <span class="hljs-keyword">is</span> <span class="hljs-string">'string'</span>
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error <span class="hljs-string">"No type given to load"</span>
  type = type.type <span class="hljs-keyword">unless</span> <span class="hljs-keyword">typeof</span> type <span class="hljs-keyword">is</span> <span class="hljs-string">'string'</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24"></a>
</div>
<p>try to load</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  <span class="hljs-built_in">require</span> <span class="hljs-string">"./type/<span class="hljs-subst">#{type}</span>"</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="is-value-empty">
  <h3>
    <a href="#is-value-empty" name="is-value-empty" class="pilcrow"></a>
Is value empty?
  </h3>
</div>

        </td>
        <td class="code highlight">
          <pre class="coffeescript"><span class="hljs-function"><span class="hljs-title">isEmpty</span> = <span class="hljs-params">(value)</span> -&gt;</span>
  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span> <span class="hljs-keyword">unless</span> value?</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26"></a>
</div>
<p>switch
when Array.isArray value
if value.length is 0
return true
when typeof value is 'object'
if value.constructor.name is 'Object' and Object.keys(value).length is 0
return true</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  <span class="hljs-literal">false</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="main-routines">
  <h2>
    <a href="#main-routines" name="main-routines" class="pilcrow"></a>
Main routines
  </h2>
</div>

        </td>
        <td class="code highlight">
          
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="get-description-of-schema">
  <h3>
    <a href="#get-description-of-schema" name="get-description-of-schema" class="pilcrow"></a>
Get description of schema
  </h3>
</div>
<p>This may be called using the spec or an already created work instance.</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">exports.describe = <span class="hljs-function"><span class="hljs-params">(work, cb)</span> -&gt;</span>
  work = <span class="hljs-keyword">new</span> Work work <span class="hljs-keyword">unless</span> work <span class="hljs-keyword">instanceof</span> Work</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29"></a>
</div>
<p>load library</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  <span class="hljs-keyword">try</span>
    lib = getTypeLib work.pos
    <span class="hljs-keyword">unless</span> lib.describe?
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error <span class="hljs-string">"Type '<span class="hljs-subst">#{work.pos.type}</span>' has no describe() method"</span>
  <span class="hljs-keyword">catch</span> error
    debug chalk.red <span class="hljs-string">"Failed to load '<span class="hljs-subst">#{work.pos.type}</span>' lib because of: <span class="hljs-subst">#{error}</span>"</span>
    <span class="hljs-keyword">return</span> cb <span class="hljs-keyword">new</span> Error <span class="hljs-string">"Type '<span class="hljs-subst">#{work.pos.type}</span>' not supported"</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30"></a>
</div>
<p>call description on that library</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  lib.describe work, cb</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="run-check">
  <h3>
    <a href="#run-check" name="run-check" class="pilcrow"></a>
Run check
  </h3>
</div>
<p>This may be called using the spec or an already created work instance.</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">exports.run = <span class="hljs-function"><span class="hljs-params">(work, cb)</span> -&gt;</span>
  work = <span class="hljs-keyword">new</span> Work work <span class="hljs-keyword">unless</span> work <span class="hljs-keyword">instanceof</span> Work</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-32" id="section-32"></a>
</div>
<p>check for references in schema</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  async.map work.pos, <span class="hljs-function"><span class="hljs-params">(v, cb)</span> -&gt;</span>
    reference.replace v,
      spec: work.spec
      path: work.path[<span class="hljs-number">0.</span>.]    <span class="hljs-comment"># clone because it may change</span>
      context: work.value
    , cb
  , <span class="hljs-function"><span class="hljs-params">(err, result)</span> -&gt;</span>
    <span class="hljs-keyword">return</span> work.report err, cb <span class="hljs-keyword">if</span> err
    work.pos = result</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-33" id="section-33"></a>
</div>
<p>check for references in values</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">    reference.replace work.value,
      spec: work.spec
      path: work.path[<span class="hljs-number">0.</span>.]    <span class="hljs-comment"># clone because it may change</span>
    , <span class="hljs-function"><span class="hljs-params">(err, value)</span> -&gt;</span>
      <span class="hljs-keyword">return</span> work.report err, cb <span class="hljs-keyword">if</span> err</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-34" id="section-34"></a>
</div>
<p>store result also in spec for references to use</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">      obj = work.spec.value
      <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> work.vpath
        obj = obj?[n]
      obj = value <span class="hljs-keyword">if</span> obj?</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-35" id="section-35"></a>
</div>
<p>and set as done</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">      work.spec.done.push work.vpath.join <span class="hljs-string">'/'</span>
      work.value = value</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-36" id="section-36"></a>
</div>
<p>load library</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">      <span class="hljs-keyword">try</span>
        lib = getTypeLib work.pos
        <span class="hljs-keyword">unless</span> lib.run?
          <span class="hljs-keyword">return</span> cb <span class="hljs-keyword">new</span> Error <span class="hljs-string">"Type '<span class="hljs-subst">#{work.pos.type}</span>' has no run() method"</span>
      <span class="hljs-keyword">catch</span> err
        debug chalk.red <span class="hljs-string">"Failed to load '<span class="hljs-subst">#{work.pos.type}</span>' lib because of: <span class="hljs-subst">#{err}</span>"</span>
        <span class="hljs-keyword">return</span> cb <span class="hljs-keyword">new</span> Error <span class="hljs-string">"Type '<span class="hljs-subst">#{work.pos.type}</span>' not supported"</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-37" id="section-37"></a>
</div>
<p>and call library to run the real check</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">      lib.run work, cb</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="selfcheck-of-schema">
  <h3>
    <a href="#selfcheck-of-schema" name="selfcheck-of-schema" class="pilcrow"></a>
Selfcheck of schema
  </h3>
</div>
<p>This may be called using the spec or an already created work instance.</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">exports.selfcheck = <span class="hljs-function"><span class="hljs-params">(schema, cb)</span> -&gt;</span>
  debug <span class="hljs-string">"check schema <span class="hljs-subst">#{util.inspect schema}</span>"</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-39" id="section-39"></a>
</div>
<p>load library and call check</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  <span class="hljs-keyword">try</span>
    lib = getTypeLib schema
    <span class="hljs-keyword">unless</span> lib.selfcheck?
      <span class="hljs-keyword">return</span> cb <span class="hljs-keyword">new</span> Error <span class="hljs-string">"Type '<span class="hljs-subst">#{schema.type}</span>' has no selfcheck() method"</span>
  <span class="hljs-keyword">catch</span>
    <span class="hljs-keyword">return</span> cb <span class="hljs-keyword">new</span> Error <span class="hljs-string">"Type '<span class="hljs-subst">#{schema.type}</span>' not supported"</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-40" id="section-40"></a>
</div>
<p>run the selfcheck</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  lib.selfcheck schema, cb</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="general-checks">
  <h2>
    <a href="#general-checks" name="general-checks" class="pilcrow"></a>
General checks
  </h2>
</div>

        </td>
        <td class="code highlight">
          
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="optional-and-default-checks">
  <h3>
    <a href="#optional-and-default-checks" name="optional-and-default-checks" class="pilcrow"></a>
Optional and default checks
  </h3>
</div>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">exports.optional =
  describe: <span class="hljs-function"><span class="hljs-params">(work)</span> -&gt;</span>
    <span class="hljs-keyword">unless</span> work.pos.optional <span class="hljs-keyword">or</span> work.pos.default?
      <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>
    <span class="hljs-keyword">if</span> work.pos.default
      value = <span class="hljs-keyword">if</span> work.pos.default <span class="hljs-keyword">instanceof</span> Function
        <span class="hljs-string">'[function]'</span>
      <span class="hljs-keyword">else</span>
        util.inspect work.pos.default
      <span class="hljs-keyword">return</span> <span class="hljs-string">"It's optional and will be set to <span class="hljs-subst">#{value}</span>
      if not specified. "</span>
    <span class="hljs-keyword">else</span>
      <span class="hljs-keyword">return</span> <span class="hljs-string">"It's optional."</span>
  run: <span class="hljs-function"><span class="hljs-params">(work)</span> -&gt;</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-43" id="section-43"></a>
</div>
<p>check for value</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span> <span class="hljs-keyword">unless</span> isEmpty work.value <span class="hljs-comment"># go on if value given</span>
    <span class="hljs-keyword">if</span> work.pos.default? <span class="hljs-comment"># use default and go on</span>
      work.value = work.pos.default
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span> <span class="hljs-keyword">if</span> work.pos.optional <span class="hljs-comment"># end this test without value</span>
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error <span class="hljs-string">"A value is needed"</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="selfcheck-schema-for-base-options">
  <h3>
    <a href="#selfcheck-schema-for-base-options" name="selfcheck-schema-for-base-options" class="pilcrow"></a>
selfcheck schema for base options
  </h3>
</div>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">exports.base =
  title:
    type: <span class="hljs-string">'string'</span>
    optional: <span class="hljs-literal">true</span>
  description:
    type: <span class="hljs-string">'string'</span>
    optional: <span class="hljs-literal">true</span>
  key:
    type: <span class="hljs-string">'regexp'</span>
    optional: <span class="hljs-literal">true</span>
  type:
    type: <span class="hljs-string">'string'</span>
  optional:
    type: <span class="hljs-string">'boolean'</span>
    optional: <span class="hljs-literal">true</span></pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
